{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://sgxanalytics.ai/schemas/weekly_graph.schema.json",
  "title": "Weekly Macro Knowledge Graph",
  "type": "object",
  "additionalProperties": false,
  "required": ["week_id", "asof_et", "nodes", "edges"],
  "properties": {
    "week_id": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
    "asof_et": { "type": "string" },
    "meta": {
      "type": "object",
      "additionalProperties": true,
      "description": "Optional: any extra metadata (source model, run id, etc.)"
    },
    "nodes": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/node" }
    },
    "edges": {
      "type": "array",
      "items": { "$ref": "#/$defs/edge" }
    }
  },
  "$defs": {
    "node": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "type", "label"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^(ast|evt|ind|nar|ent|scn):[A-Za-z0-9_\\-\\.]+$"
        },
        "type": {
          "type": "string",
          "enum": ["ASSET", "EVENT", "INDICATOR", "NARRATIVE", "ENTITY", "SCENARIO"]
        },
        "label": { "type": "string", "minLength": 1, "maxLength": 140 },
        "week_id": { "type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$" },
        "tags": {
          "type": "array",
          "items": { "type": "string", "minLength": 1, "maxLength": 40 },
          "maxItems": 20
        },
        "payload": {
          "type": "object",
          "additionalProperties": true,
          "description": "Optional node metadata (ticker, date_et, indicator_type, etc.)"
        }
      }
    },
    "edge": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "source", "target", "relation", "time_window"],
      "properties": {
        "id": { "type": "string", "pattern": "^e:[A-Za-z0-9_\\-\\.]+$" },
        "source": {
          "type": "string",
          "pattern": "^(ast|evt|ind|nar|ent|scn):[A-Za-z0-9_\\-\\.]+$"
        },
        "target": {
          "type": "string",
          "pattern": "^(ast|evt|ind|nar|ent|scn):[A-Za-z0-9_\\-\\.]+$"
        },
        "relation": {
          "type": "string",
          "enum": [
            "DRIVES",
            "CATALYST_FOR",
            "INFLUENCES",
            "EVIDENCES",
            "SUPPORTS",
            "RISKS",
            "HEDGES",
            "CORRELATES",
            "PRICED_IN_BY",
            "CONTRADICTS"
          ]
        },
        "sign": { "type": "string", "enum": ["+", "-", "0"], "default": "0" },
        "strength": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Directional impact strength (0..1)."
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Confidence in this edge (0..1)."
        },
        "time_window": {
          "type": "string",
          "enum": ["7D", "INTRADAY", "EVENT", "UNKNOWN"]
        },
        "condition": {
          "type": "string",
          "maxLength": 240,
          "description": "Scenario condition like: 'if NFP < 50k'."
        },
        "evidence": {
          "type": "array",
          "items": { "type": "string", "minLength": 1, "maxLength": 240 },
          "maxItems": 10
        },
        "edge_tags": {
          "type": "array",
          "items": { "type": "string", "minLength": 1, "maxLength": 40 },
          "maxItems": 20
        }
      }
    }
  }
}
